name: Playwright E2E Tests (SauceDemo)

# 1. KÍCH HOẠT (Trigger): Xác định khi nào Workflow sẽ chạy
on:
  # Chạy khi có code được đẩy (push) lên nhánh chính (main)
  push:
    branches: [ "main" ]
  # Chạy khi có Pull Request được mở cho nhánh chính
  pull_request:
    branches: [ "main" ]

# 2. CÁC CÔNG VIỆC (Jobs): Định nghĩa các tác vụ cần thực hiện
jobs:
  test:
    # Chạy trên hệ điều hành Ubuntu mới nhất (Máy chủ Linux)
    runs-on: ubuntu-latest
    
    steps:
    # 2.1. Lấy code: Sao chép code từ repository về máy chủ CI
    - name: Checkout repository code
      uses: actions/checkout@v4
    
    # 2.2. Thiết lập Node.js: Cài đặt phiên bản Node.js (nên dùng LTS)
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 20 # Thay đổi nếu Sếp dùng phiên bản khác

    # 2.3. Cài đặt Phụ thuộc (Dependencies)
    - name: Install dependencies
      # npm ci là lệnh sạch và nhanh hơn cho CI
      run: npm ci 

    # 2.5. Chạy Kiểm thử E2E
    - name: Run Playwright tests
      # Sử dụng lệnh đã định nghĩa trong package.json
      run: npm run test:ci 
      
    # 2.6. Tải lên Báo cáo (Upload Artifacts)
# File: .github/workflows/tests.yml (Chỉ sửa bước chạy test)
    # ...
    - name: Run Playwright tests
      # Thêm tùy chọn --output và --reporter để đảm bảo tạo thư mục playwright-report
      run: npx playwright test --reporter=list,junit,html --output=playwright-report
      
    - name: Upload Test Report (on failure or success)
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: playwright-html-report
        path: playwright-report/  # <<< ĐÃ ĐƯỢC TẠO CHÍNH XÁC BỞI LỆNH TRÊN
        retention-days: 5

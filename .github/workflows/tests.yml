name: Playwright E2E Tests (SauceDemo)

# 1. KÍCH HOẠT (Trigger): Xác định khi nào Workflow sẽ chạy
on:
  # Chạy khi có code được đẩy (push) lên nhánh chính (main)
  push:
    branches: [ "main" ]
  # Chạy khi có Pull Request được mở cho nhánh chính
  pull_request:
    branches: [ "main" ]

# 2. CÁC CÔNG VIỆC (Jobs): Định nghĩa các tác vụ cần thực hiện
jobs:
  test:
    # Chạy trên hệ điều hành Ubuntu mới nhất (Máy chủ Linux)
    runs-on: ubuntu-latest
    
    steps:
    # 2.1. Lấy code: Sao chép code từ repository về máy chủ CI
    - name: Checkout repository code
      uses: actions/checkout@v4
    
    # 2.2. Thiết lập Node.js: Cài đặt phiên bản Node.js (nên dùng LTS)
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 20 # Thay đổi nếu Sếp dùng phiên bản khác

    # 2.3. Cài đặt Phụ thuộc (Dependencies)
    - name: Install dependencies
      # npm ci là lệnh sạch và nhanh hơn cho CI
      run: npm ci 

    # 2.4. Cài đặt Trình duyệt Playwright (BẮT BUỘC cho E2E)
    - name: Install Playwright browsers
      # Lệnh này tải các trình duyệt Chromium, Firefox, WebKit
      run: npx playwright install --with-deps

    # 2.5. Chạy Kiểm thử E2E
    - name: Run Playwright tests
      # Sử dụng lệnh đã định nghĩa trong package.json
      run: npm run test:ci 
      
    # 2.6. Tải lên Báo cáo (Upload Artifacts)
    # Bước này giúp Sếp xem báo cáo HTML nếu test thất bại
    - name: Upload Test Report (on failure or success)
      if: always() # Đảm bảo bước này luôn chạy, ngay cả khi các bước trước bị lỗi
      uses: actions/upload-artifact@v4
      with:
        name: playwright-html-report
        path: playwright-report/
        retention-days: 5 # Lưu báo cáo trong 5 ngày